---
import Layout from "../layouts/Layout.astro";
// Force rebuild
import { getCollection } from "astro:content";

const posts = await getCollection("posts");
const personalPosts = posts
    .filter(
        (post) =>
            post.data.category === "personal" ||
            post.data.category === "essay" ||
            post.data.category === "story" ||
            !post.data.category,
    )
    .sort((a, b) => {
        if (a.data.date && b.data.date) {
            return (
                new Date(b.data.date).getTime() -
                new Date(a.data.date).getTime()
            );
        }
        if (a.data.date) return -1;
        if (b.data.date) return 1;
        return 0;
    });
---

<Layout title="Personal | Berken Tekin">
    <div class="flex flex-col md:flex-row min-h-screen">
        <aside
            class="w-full md:w-1/3 border-r border-black dark:border-zinc-700 p-8 md:h-screen md:sticky md:top-0 overflow-y-auto bg-white dark:bg-zinc-900 z-10"
        >
            <header class="mb-12">
                <h1 class="text-4xl font-black mb-2 tracking-tighter">
                    Personal
                </h1>
                <a
                    href="/"
                    class="text-sm font-bold tracking-normal hover:underline"
                    >&larr; Back Home</a
                >
            </header>

            <div class="space-y-6">
                {
                    personalPosts.map((post) => (
                        <article class="group mb-4">
                            <a
                                href={`/personal/${post.id.replace(/\.[^/.]+$/, "")}`}
                                class="block"
                            >
                                <h2 class="text-xl font-bold mb-1 group-hover:underline decoration-1 underline-offset-4 leading-tight">
                                    {post.data.title}
                                </h2>
                                {post.data.date && (
                                    <p class="text-xs text-gray-500 dark:text-gray-400 font-serif italic">
                                        {new Date(
                                            post.data.date,
                                        ).toLocaleDateString("nl-NL", {
                                            year: "numeric",
                                            month: "2-digit",
                                            day: "2-digit",
                                        })}
                                    </p>
                                )}
                            </a>
                        </article>
                    ))
                }
            </div>
        </aside>

        <main
            class="hidden md:flex w-full md:w-2/3 p-12 items-center justify-center bg-white dark:bg-zinc-900 min-h-screen"
        >
            <div class="text-center max-w-md">
                <p class="text-2xl font-serif italic text-gray-400 mb-4">
                    Select a story from the list to begin reading.
                </p>
                <div class="w-16 h-1 bg-gray-200 mx-auto"></div>
            </div>
        </main>
    </div>
</Layout>
